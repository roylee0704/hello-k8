
# ingress

## The Ingress Resources

As with all other Kubernetes resources, an Ingress needs `apiVersion`, `kind`, and `metadata` fields. The name of an Ingress object must be a valid DNS subdomain name. For general information about working with config files, see deploying applications, configuring containers, managing resources. Ingress frequently uses annotations to configure some options depending on the Ingress controller, an example of which is the rewrite-target annotation. Different Ingress controller support different annotations. Review the documentation for your choice of Ingress controller to learn which annotations are supported.


The Ingress `spec` has all the information needed to configure a load balancer or proxy server. Most importantly, it contains a list of rules matched against all incoming requests. Ingress resource only supports rules for directing HTTP traffic.


A generic template for ingress resource generated by `helm`.
```yaml
{{- if .Values.ingress.enabled -}}
{{- $fullName := include "helm.fullname" . -}}
{{- $ingressPath := .Values.ingress.path -}}
{{- $name := include "helm.name" . -}}
{{- $servicePortName := .Values.service.name -}}
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: {{ $fullName }}
  labels:
    app.kubernetes.io/name: {{ include "helm.name" . }}
    helm.sh/chart: {{ include "helm.chart" . }}
    app.kubernetes.io/instance: {{ .Release.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
{{- with .Values.ingress.annotations }}
  annotations:
{{ toYaml . | indent 4 }}
{{- end }}
spec:
{{- if .Values.ingress.tls }}
  tls:
  {{- range .Values.ingress.tls }}
    - hosts:
      {{- range .hosts }}
        - {{ . | quote }}
      {{- end }}
      secretName: {{ .secretName }}
  {{- end }}
{{- end }}
  rules:
  {{- range .Values.ingress.hosts }}
    - host: {{ . | quote }}
      http:
        paths:
          {{- range $ingressPath }}
          - path: {{ . }}
            backend:
              serviceName: {{ $name }}
              servicePort: {{ $servicePortName }}
          {{- end }}
  {{- end }}
{{- end }}
```



### Definitions

- **backend**. Refers to your Service Resource (i.e: clusterIP, nodePort) name + port.


## The Ingress Controllers

In order for the Ingress resource to work, the cluster must have an ingress controller running.

Unlike other types of controllers which run as part of the `kube-controller-manager` binary, Ingress controllers are **not started automatically with a cluster**.

### Installation [docs](https://github.com/kubernetes-sigs/aws-load-balancer-controller/blob/ed6b8669c0b08148b0309c229d2617425d514fe1/docs/guide/controller/installation.md#aws-load-balancer-controller-installation-guide)

As per docs, you may install it [via helm: eks-chart](https://github.com/aws/eks-charts/tree/master/stable/aws-load-balancer-controller) or manually. We will go with the `helm` way.






# References
- https://www.eksworkshop.com/beginner/130_exposing-service/ingress/
- https://github.com/kubernetes-sigs/aws-load-balancer-controller/blob/ed6b8669c0b08148b0309c229d2617425d514fe1/docs/guide/controller/installation.md#aws-load-balancer-controller-installation-guide